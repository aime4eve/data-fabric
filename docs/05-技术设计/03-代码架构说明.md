# é¡¹ç›®ç»“æ„è¯´æ˜

## ğŸ“ ç›®å½•ç»“æ„æ¦‚è§ˆ

æœ¬é¡¹ç›®é‡‡ç”¨é¢†åŸŸé©±åŠ¨è®¾è®¡(DDD)æ¶æ„ï¼Œç›®å½•ç»“æ„æ¸…æ™°åˆ†å±‚ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•ã€‚

```
knowledge-base-app/
â”œâ”€â”€ src/                          # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ backend/                  # åç«¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ domain/               # é¢†åŸŸå±‚ - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ application/          # åº”ç”¨å±‚ - ä¸šåŠ¡ç”¨ä¾‹åè°ƒ
â”‚   â”‚   â”œâ”€â”€ infrastructure/       # åŸºç¡€è®¾æ–½å±‚ - æŠ€æœ¯å®ç°
â”‚   â”‚   â”œâ”€â”€ presentation/         # è¡¨ç¤ºå±‚ - APIæ¥å£
â”‚   â”‚   â””â”€â”€ shared_kernel/        # å…±äº«å†…æ ¸ - é€šç”¨ç»„ä»¶
â”‚   â””â”€â”€ frontend/                 # å‰ç«¯åº”ç”¨
â”‚       â”œâ”€â”€ application/          # å‰ç«¯åº”ç”¨å±‚
â”‚       â”œâ”€â”€ infrastructure/       # å‰ç«¯åŸºç¡€è®¾æ–½å±‚
â”‚       â”œâ”€â”€ presentation/         # å‰ç«¯è¡¨ç¤ºå±‚
â”‚       â””â”€â”€ shared/               # å‰ç«¯å…±äº«å±‚
â”œâ”€â”€ tests/                        # æµ‹è¯•ç›®å½•
â”œâ”€â”€ docs/                         # æ–‡æ¡£ç›®å½•
â”œâ”€â”€ scripts/                      # è„šæœ¬å·¥å…·
â”œâ”€â”€ docker-compose.yml           # DockeræœåŠ¡é…ç½®
â”œâ”€â”€ setup_dev_env.sh             # ç¯å¢ƒæ­å»ºè„šæœ¬
â””â”€â”€ README.md                     # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## ğŸ—ï¸ åˆ†å±‚æ¶æ„è¯¦è§£

### 1. é¢†åŸŸå±‚ (Domain Layer)

**ä½ç½®**: `src/backend/domain/`

**èŒè´£**: åŒ…å«æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œä¸ä¾èµ–ä»»ä½•å¤–éƒ¨æŠ€æœ¯å®ç°

**ä¸»è¦ç»„ä»¶**:
- **entities/**: å®ä½“å®šä¹‰ï¼Œå…·æœ‰å”¯ä¸€æ ‡è¯†çš„ä¸šåŠ¡å¯¹è±¡
- **value_objects/**: å€¼å¯¹è±¡ï¼Œæè¿°é¢†åŸŸæ¦‚å¿µçš„æ— çŠ¶æ€å¯¹è±¡
- **aggregates/**: èšåˆæ ¹ï¼Œç»´æŠ¤ä¸šåŠ¡è§„åˆ™çš„ä¸€è‡´æ€§è¾¹ç•Œ
- **repositories/**: ä»“åº“æ¥å£ï¼Œå®šä¹‰é¢†åŸŸå¯¹è±¡çš„æŒä¹…åŒ–å¥‘çº¦
- **services/**: é¢†åŸŸæœåŠ¡ï¼Œå¤„ç†è·¨å®ä½“çš„ä¸šåŠ¡é€»è¾‘
- **events/**: é¢†åŸŸäº‹ä»¶ï¼Œè®°å½•é‡è¦çš„ä¸šåŠ¡äº‹ä»¶
- **knowledge/**: çŸ¥è¯†ç®¡ç†å­åŸŸ
- **graph/**: å›¾æ•°æ®åº“å­åŸŸ
- **user/**: ç”¨æˆ·ç®¡ç†å­åŸŸ

**ç¤ºä¾‹**:
```python
# domain/entities/knowledge.py
class KnowledgeEntity:
    def __init__(self, id: str, title: str, content: str):
        self.id = id
        self.title = title
        self.content = content
        self.created_at = datetime.now()
    
    def update_content(self, new_content: str):
        if len(new_content) < 10:
            raise ValueError("å†…å®¹é•¿åº¦ä¸èƒ½å°‘äº10ä¸ªå­—ç¬¦")
        self.content = new_content
```

### 2. åº”ç”¨å±‚ (Application Layer)

**ä½ç½®**: `src/backend/application/`

**èŒè´£**: åè°ƒé¢†åŸŸå¯¹è±¡æ‰§è¡Œç‰¹å®šçš„ä¸šåŠ¡ç”¨ä¾‹ï¼Œä¸åŒ…å«ä¸šåŠ¡è§„åˆ™

**ä¸»è¦ç»„ä»¶**:
- **services/**: åº”ç”¨æœåŠ¡ï¼Œåè°ƒä¸šåŠ¡ç”¨ä¾‹çš„æ‰§è¡Œ
- **dto/**: æ•°æ®ä¼ è¾“å¯¹è±¡ï¼Œç”¨äºå±‚é—´æ•°æ®ä¼ é€’
- **commands/**: å‘½ä»¤å¯¹è±¡ï¼Œå°è£…å†™æ“ä½œè¯·æ±‚
- **queries/**: æŸ¥è¯¢å¯¹è±¡ï¼Œå°è£…è¯»æ“ä½œè¯·æ±‚
- **handlers/**: å‘½ä»¤/æŸ¥è¯¢å¤„ç†å™¨
- **mappers/**: å¯¹è±¡æ˜ å°„å™¨ï¼Œè½¬æ¢ä¸åŒå±‚é—´çš„æ•°æ®æ ¼å¼

**ç¤ºä¾‹**:
```python
# application/services/knowledge_service.py
class KnowledgeApplicationService:
    def __init__(self, knowledge_repo: KnowledgeRepository):
        self.knowledge_repo = knowledge_repo
    
    def create_knowledge(self, command: CreateKnowledgeCommand):
        knowledge = KnowledgeEntity(
            id=generate_id(),
            title=command.title,
            content=command.content
        )
        self.knowledge_repo.save(knowledge)
        return KnowledgeDTO.from_entity(knowledge)
```

### 3. åŸºç¡€è®¾æ–½å±‚ (Infrastructure Layer)

**ä½ç½®**: `src/backend/infrastructure/`

**èŒè´£**: æä¾›æŠ€æœ¯å®ç°ï¼Œå¦‚æ•°æ®åº“è®¿é—®ã€å¤–éƒ¨æœåŠ¡é›†æˆç­‰

**ä¸»è¦ç»„ä»¶**:
- **persistence/**: æŒä¹…åŒ–å®ç°
  - **nebula_graph/**: NebulaGraphå›¾æ•°æ®åº“å®ç°
  - **redis/**: Redisç¼“å­˜å®ç°
  - **files/**: æ–‡ä»¶å­˜å‚¨å®ç°
- **external_services/**: å¤–éƒ¨æœåŠ¡é›†æˆ
  - **ai_services/**: AIæœåŠ¡é›†æˆ
  - **search/**: æœç´¢æœåŠ¡é›†æˆ
  - **notification/**: é€šçŸ¥æœåŠ¡é›†æˆ
- **repositories/**: ä»“åº“å®ç°
- **messaging/**: æ¶ˆæ¯ä¼ é€’å®ç°
- **config/**: é…ç½®ç®¡ç†
- **logging/**: æ—¥å¿—ç®¡ç†

**ç¤ºä¾‹**:
```python
# infrastructure/repositories/knowledge_repository.py
class KnowledgeRepositoryImpl(KnowledgeRepository):
    def __init__(self, nebula_client: NebulaClient):
        self.nebula_client = nebula_client
    
    def save(self, knowledge: KnowledgeEntity):
        query = """
        INSERT VERTEX KnowledgeEntity(id, title, content) 
        VALUES '{}':('{}', '{}', '{}')
        """.format(knowledge.id, knowledge.id, knowledge.title, knowledge.content)
        self.nebula_client.execute(query)
    
    def find_by_id(self, id: str) -> Optional[KnowledgeEntity]:
        query = f"FETCH PROP ON KnowledgeEntity '{id}'"
        result = self.nebula_client.execute(query)
        return self._map_to_entity(result)
```

### 4. è¡¨ç¤ºå±‚ (Presentation Layer)

**ä½ç½®**: `src/backend/presentation/`

**èŒè´£**: å¤„ç†ç”¨æˆ·è¯·æ±‚å’Œå“åº”ï¼Œæä¾›APIæ¥å£

**ä¸»è¦ç»„ä»¶**:
- **rest_api/**: REST APIå®ç°
  - **controllers/**: æ§åˆ¶å™¨ï¼Œå¤„ç†HTTPè¯·æ±‚
  - **middleware/**: ä¸­é—´ä»¶ï¼Œå¤„ç†æ¨ªåˆ‡å…³æ³¨ç‚¹
  - **validators/**: è¯·æ±‚éªŒè¯å™¨
  - **serializers/**: å“åº”åºåˆ—åŒ–å™¨
  - **routers/**: è·¯ç”±é…ç½®

**ç¤ºä¾‹**:
```python
# presentation/rest_api/controllers/knowledge_controller.py
@api.route('/knowledge')
class KnowledgeController(Resource):
    @api.expect(knowledge_model)
    @api.marshal_with(knowledge_response)
    def post(self):
        """åˆ›å»ºçŸ¥è¯†æ¡ç›®"""
        command = CreateKnowledgeCommand(**api.payload)
        result = knowledge_service.create_knowledge(command)
        return result, 201
```

### 5. å…±äº«å†…æ ¸ (Shared Kernel)

**ä½ç½®**: `src/backend/shared_kernel/`

**èŒè´£**: æä¾›å„å±‚å…±äº«çš„åŸºç¡€ç»„ä»¶å’Œå·¥å…·

**ä¸»è¦ç»„ä»¶**:
- **exceptions/**: é€šç”¨å¼‚å¸¸å®šä¹‰
- **utils/**: å·¥å…·ç±»å’Œå‡½æ•°
- **constants/**: å¸¸é‡å®šä¹‰
- **interfaces/**: å…±äº«æ¥å£å®šä¹‰

**ç¤ºä¾‹**:
```python
# shared_kernel/exceptions.py
class DomainException(Exception):
    """é¢†åŸŸå¼‚å¸¸åŸºç±»"""
    pass

class BusinessRuleException(DomainException):
    """ä¸šåŠ¡è§„åˆ™å¼‚å¸¸"""
    pass

# shared_kernel/utils.py
def generate_id() -> str:
    """ç”Ÿæˆå”¯ä¸€æ ‡è¯†ç¬¦"""
    return str(uuid.uuid4())
```

## ğŸ¯ å‰ç«¯æ¶æ„

### å‰ç«¯åˆ†å±‚

**ä½ç½®**: `src/frontend/`

**ä¸»è¦ç»„ä»¶**:
- **application/**: å‰ç«¯åº”ç”¨å±‚ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘
- **infrastructure/**: å‰ç«¯åŸºç¡€è®¾æ–½å±‚ï¼Œå¤„ç†APIè°ƒç”¨å’Œå­˜å‚¨
- **presentation/**: å‰ç«¯è¡¨ç¤ºå±‚ï¼ŒReactç»„ä»¶å’Œé¡µé¢
- **shared/**: å‰ç«¯å…±äº«å±‚ï¼Œå·¥å…·å‡½æ•°å’Œå¸¸é‡

**ç¤ºä¾‹**:
```typescript
// infrastructure/api_client/knowledge_api.ts
export class KnowledgeAPI {
  async createKnowledge(data: CreateKnowledgeDTO): Promise<Knowledge> {
    const response = await axios.post('/api/knowledge', data);
    return response.data;
  }
}

// presentation/components/KnowledgeForm.tsx
export const KnowledgeForm: React.FC = () => {
  const { createKnowledge } = useKnowledgeService();
  
  const handleSubmit = async (values: KnowledgeFormValues) => {
    await createKnowledge(values);
    message.success('çŸ¥è¯†æ¡ç›®åˆ›å»ºæˆåŠŸ');
  };
  
  return (
    <Form onFinish={handleSubmit}>
      <Form.Item name="title" rules={[{ required: true }]}>
        <Input placeholder="è¯·è¾“å…¥æ ‡é¢˜" />
      </Form.Item>
      <Form.Item name="content" rules={[{ required: true }]}>
        <TextArea placeholder="è¯·è¾“å…¥å†…å®¹" />
      </Form.Item>
      <Button type="primary" htmlType="submit">
        åˆ›å»º
      </Button>
    </Form>
  );
};
```

## ğŸ§ª æµ‹è¯•æ¶æ„

### æµ‹è¯•åˆ†å±‚

**ä½ç½®**: `tests/`

**ä¸»è¦ç»„ä»¶**:
- **unit/**: å•å…ƒæµ‹è¯•ï¼Œæµ‹è¯•å•ä¸ªç»„ä»¶
- **integration/**: é›†æˆæµ‹è¯•ï¼Œæµ‹è¯•ç»„ä»¶é—´çš„äº¤äº’
- **e2e/**: ç«¯åˆ°ç«¯æµ‹è¯•ï¼Œæµ‹è¯•å®Œæ•´ç”¨æˆ·æµç¨‹

**ç¤ºä¾‹**:
```python
# tests/unit/domain/test_knowledge_entity.py
def test_knowledge_entity_creation():
    knowledge = KnowledgeEntity(
        id="test-123",
        title="æµ‹è¯•çŸ¥è¯†",
        content="è¿™æ˜¯æµ‹è¯•å†…å®¹"
    )
    assert knowledge.id == "test-123"
    assert knowledge.title == "æµ‹è¯•çŸ¥è¯†"

def test_knowledge_content_validation():
    knowledge = KnowledgeEntity("test-123", "æ ‡é¢˜", "å†…å®¹")
    with pytest.raises(ValueError):
        knowledge.update_content("çŸ­")  # å°‘äº10ä¸ªå­—ç¬¦åº”è¯¥æŠ¥é”™
```

## ğŸ“š æ–‡æ¡£æ¶æ„

### æ–‡æ¡£åˆ†ç±»

**ä½ç½®**: `docs/`

**ä¸»è¦ç»„ä»¶**:
- **api/**: APIæ–‡æ¡£ï¼ŒåŒ…å«RESTå’ŒGraphQLæ–‡æ¡£
- **architecture/**: æ¶æ„æ–‡æ¡£ï¼ŒåŒ…å«DDDå’Œéƒ¨ç½²æ¶æ„
- **deployment/**: éƒ¨ç½²æ–‡æ¡£ï¼ŒåŒ…å«Dockerå’ŒKubernetesé…ç½®

## ğŸ”§ è„šæœ¬å·¥å…·

### å¼€å‘å·¥å…·

**ä½ç½®**: `scripts/`

**ä¸»è¦ç»„ä»¶**:
- **dev/**: å¼€å‘è„šæœ¬ï¼Œç¯å¢ƒæ­å»ºå’Œæ—¥å¸¸å¼€å‘
- **build/**: æ„å»ºè„šæœ¬ï¼Œé¡¹ç›®æ„å»ºå’Œæ‰“åŒ…
- **deploy/**: éƒ¨ç½²è„šæœ¬ï¼Œç¯å¢ƒéƒ¨ç½²å’Œå‘å¸ƒ
- **test/**: æµ‹è¯•è„šæœ¬ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•æ‰§è¡Œ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒæ­å»º

```bash
# è¿è¡Œä¸€é”®æ­å»ºè„šæœ¬
./setup_dev_env.sh

# æˆ–è€…æ‰‹åŠ¨æ­å»º
python3 -m venv venv
source venv/bin/activate
pip install -r src/backend/requirements.txt
cd src/frontend && npm install
```

### 2. å¯åŠ¨æœåŠ¡

```bash
# ä½¿ç”¨Docker Composeå¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æˆ–è€…åˆ†åˆ«å¯åŠ¨
./start_dev.sh
```

### 3. è®¿é—®åº”ç”¨

- **å‰ç«¯åº”ç”¨**: http://localhost:3000
- **åç«¯API**: http://localhost:5000
- **ç›‘æ§é¢æ¿**: http://localhost:3001
- **æ•°æ®åº“ç®¡ç†**: http://localhost:7000

## ğŸ“– å¼€å‘æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½

1. **å®šä¹‰é¢†åŸŸæ¨¡å‹**: åœ¨`domain/`ç›®å½•ä¸‹å®šä¹‰å®ä½“å’Œå€¼å¯¹è±¡
2. **åˆ›å»ºåº”ç”¨æœåŠ¡**: åœ¨`application/`ç›®å½•ä¸‹åˆ›å»ºåº”ç”¨æœåŠ¡
3. **å®ç°åŸºç¡€è®¾æ–½**: åœ¨`infrastructure/`ç›®å½•ä¸‹å®ç°æŠ€æœ¯ç»†èŠ‚
4. **æ·»åŠ APIæ¥å£**: åœ¨`presentation/`ç›®å½•ä¸‹åˆ›å»ºæ§åˆ¶å™¨
5. **ç¼–å†™æµ‹è¯•**: åœ¨`tests/`ç›®å½•ä¸‹æ·»åŠ ç›¸åº”æµ‹è¯•

### ä»£ç è§„èŒƒ

- **åç«¯**: ä½¿ç”¨Blackæ ¼å¼åŒ–ä»£ç ï¼Œéµå¾ªPEP 8è§„èŒƒ
- **å‰ç«¯**: ä½¿ç”¨Prettieræ ¼å¼åŒ–ä»£ç ï¼Œéµå¾ªReactæœ€ä½³å®è·µ
- **å‘½å**: ä½¿ç”¨æ¸…æ™°ã€æè¿°æ€§çš„å‘½åï¼Œé¿å…ç¼©å†™
- **æ³¨é‡Š**: ä¸ºå¤æ‚ä¸šåŠ¡é€»è¾‘æ·»åŠ è¯¦ç»†æ³¨é‡Š

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•æ·»åŠ æ–°çš„å­åŸŸï¼Ÿ
A: åœ¨`domain/`ã€`application/`å’Œ`infrastructure/`ç›®å½•ä¸‹åˆ›å»ºå¯¹åº”çš„å­åŸŸç›®å½•ï¼Œéµå¾ªç›¸åŒçš„åˆ†å±‚ç»“æ„ã€‚

### Q: å¦‚ä½•å¤„ç†è·¨åŸŸè¯·æ±‚ï¼Ÿ
A: åœ¨`presentation/rest_api/middleware/`ä¸­æ·»åŠ CORSä¸­é—´ä»¶é…ç½®ã€‚

### Q: å¦‚ä½•æ·»åŠ æ–°çš„APIç«¯ç‚¹ï¼Ÿ
A: åœ¨`presentation/rest_api/controllers/`ä¸­åˆ›å»ºæ–°çš„æ§åˆ¶å™¨ç±»ï¼Œå¹¶åœ¨è·¯ç”±ä¸­æ³¨å†Œã€‚

### Q: å¦‚ä½•é…ç½®æ•°æ®åº“è¿æ¥ï¼Ÿ
A: ä¿®æ”¹`src/backend/.env`æ–‡ä»¶ä¸­çš„æ•°æ®åº“é…ç½®å‚æ•°ã€‚

---

**æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è€ƒå„ç›®å½•ä¸‹çš„READMEæ–‡ä»¶å’Œä»£ç æ³¨é‡Šã€‚**