# 可观测性与健康检查设计

## 指标（Prometheus）
- `permission_apply_count`：模板应用次数与结果标签（success/failure）。
- `permission_conflict_count`：权限冲突计数，按目录与角色分维度。
- `directory_move_count`：目录移动/重命名次数。
- `audit_event_count`：审计事件写入计数与类型分布。

## 结构化日志
- 关键字段：`trace_id`、`actor`、`resource_id`、`action`、`result`、`duration_ms`。
- 采样策略：批量操作按失败与慢请求加密集采样。

## 健康检查
- `GET /healthz`：返回 DB、搜索、存储依赖状态与版本。
- 依赖超时与降级：在不可用时返回降级提示并记录审计。